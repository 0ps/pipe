const version="1512012454645",staticServePath="http://locoalhost:5897/",imgServePath="https://img.hacpai.com/",servePath="http://locoalhost:5897/";self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(function(e){return Promise.all(e.map(function(e){if("pipe-html"!==e&&"pipe-image"!==e&&e!=="pipe-static-"+version)return caches.delete(e)}))}))}),self.addEventListener("fetch",e=>{0===e.request.headers.get("accept").indexOf("text/html")||"*/*"===e.request.headers.get("accept")&&-1===e.request.url.indexOf("/js/")?e.respondWith(fetch(e.request).then(function(t){return-1===e.request.url.indexOf(servePath)?t:caches.open("pipe-html").then(function(r){return"POST"!==e.request.method&&"DELETE"!==e.request.method&&"PUT"!==e.request.method&&r.put(e.request,t.clone()),t})}).catch(function(){return caches.match(e.request)})):e.respondWith(caches.match(e.request).then(t=>t||fetch(e.request).then(function(t){return e.request.url.indexOf(imgServePath)>-1?caches.open("pipe-image").then(function(r){return r.put(e.request,t.clone()),t}):e.request.url.indexOf(staticServePath)>-1?caches.open("pipe-static-"+version).then(function(r){return r.put(e.request,t.clone()),t}):t}).catch(function(){console.log(`fetch ${e.request.url} error`)})))});